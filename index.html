<!DOCTYPE html>
<html>
<head>
  <title>Enter Code</title>
</head>
<body style="text-align:center;font-family:sans-serif;padding:40px;">

<h2>Enter Spin Code</h2>

<input type="text" id="codeInput" placeholder="Enter Code">
<br><br>
<button id="checkBtn">Submit</button>

<p id="message"></p>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById("checkBtn").addEventListener("click", async () => {

  const code = document.getElementById("codeInput").value.trim().toUpperCase();

  const docRef = doc(db, "codes", code);
  const docSnap = await getDoc(docRef);

  if (!docSnap.exists()) {
    document.getElementById("message").innerText = "❌ Invalid Code";
    return;
  }

  if (docSnap.data().used === true) {
    document.getElementById("message").innerText = "⚠ Code Already Used";
    return;
  }

  // Mark code as used
  await updateDoc(docRef, {
    used: true
  });

  // Redirect to spin page
  window.location.href = "spin.html";

});

</script>

</body>
</html>
